<div class="vs-background-color-light vs-container">
  <div class="row vs-margin-remove vs-display-flex">
    <div [ngClass]="{'col-md-10': isCreatingRequest, 'col-md-12': !isCreatingRequest}"
      class="col col-sm-12 vs-margin-top-small vs-margin-center"
    >

      <h1 *ngIf="isCreatingRequest" [routerLink]="['/dashboard']" class="vs-font-xsmall vs-color-dark-grey remove-focus vs-cursor-pointer vs-color-vs">
        <i class="fas fa-arrow-left vs-color-vs fa-sm vs-margin-right-xsmall"></i>
          REGRESAR AL DASHBOARD
      </h1>

      <div class="vs-section vs-background-color-white">
        <mat-horizontal-stepper labelPosition="bottom" #stepper>

          <!-- first stepper -->
          <mat-step>
            <h1 class="vs-section-title vs-color-vs vs-text-align-center">
              SELECCIONA TU TIPO DE SERVICIO
            </h1>
            <p class="vs-text-align-center vs-color-grey vs-margin-bottom-medium">
              Tenemos disponibilidad las 24 horas
            </p>
            <form [formGroup]="request">
              <div formGroupName="tipoDeServicio" class="vs-input-field row vs-text-align-center">
                <mat-radio-group formControlName="nombre" class="radio-group">
                  <mat-radio-button class="col-sm-12 col-md-4 radio-button vs-margin-bottom-small" value="transporte de carga">
                    <img src="../../../assets/img/servicios/transporte de carga.png" alt="">
                    <h1 class="vs-font-small vs-color-default vs-text-align-center">
                      Transporte de carga
                    </h1>
                  </mat-radio-button>
                  <mat-radio-button class="col-sm-12 col-md-4 vs-margin-bottom-small" value="alquiler de montacarga">
                    <img src="../../../assets/img/servicios/alquiler de montacarga.png" alt="">
                    <h1 class="vs-font-small vs-color-default vs-text-align-center">
                      Alquiler montacargas
                    </h1>
                  </mat-radio-button>
                  <mat-radio-button class="col-sm-12 col-md-4 vs-margin-bottom-small" value="alquiler de grua">
                    <img src="../../../assets/img/servicios/alquiler de grua.png" alt="">
                    <h1 class="vs-font-small vs-color-default vs-text-align-center">
                      Alquiler de gruas
                    </h1>
                  </mat-radio-button>
                  <mat-radio-button class="col-sm-12 col-md-4 vs-margin-bottom-small" value="operario de cargue y descargue">
                    <img src="../../../assets/img/servicios/operario de cargue y descargue.png" alt="">
                    <h1 class="vs-font-small vs-color-default vs-text-align-center">
                      Operario de cargue y descargue
                    </h1>
                  </mat-radio-button>
                </mat-radio-group>
              </div>
              <div class="vs-input-field vs-margin-top-medium col-sm-12 vs-text-align-right">
                <button mat-flat-button [disabled]="!request?.get('tipoDeServicio').valid" color="primary" matStepperNext>
                  CONTINUAR
                </button>
              </div>
            </form>
          </mat-step>

           <!-- second step -->
          <mat-step>
            <h1 class="vs-section-title vs-color-vs vs-text-align-center">
              {{ request.value.tipoDeServicio.nombre | uppercase }}? LISTO!!
            </h1>
            <p class="vs-text-align-center vs-color-grey vs-margin-bottom-large">
              LLena los siguientes campos y te contactaremos un {{request.value.tipoDeServicio.nombre}} en minutos!!
            </p>
            <form [formGroup]="request" class="row">
              <!-- Tipo de Servico-->
              <div formGroupName="tipoDeServicio" class="vs-input-field col-md-5">
                <span *ngIf="request.value.tipoDeServicio.nombre == 'transporte de carga'" class="vs-field-label">Tipo de Servicio</span>
                <span *ngIf="request.value.tipoDeServicio.nombre == 'alquiler de grua'" class="vs-field-label">Tipo de Servicio</span>
                <select *ngIf="request.value.tipoDeServicio.nombre == 'transporte de carga'" formControlName="especificamente" class="form-control" aria-placeholder="tipo de persona">
                  <option selected="true" disabled="disabled">Tipo de Servicio</option>
                  <option value="transporte de carga seca">Transporte de carga seca</option>
                  <option value="transporte de contenedores">Transporte de contenedores</option>
                  <option value="transporte de refrigerados">Transporte de refrigerados</option>
                  <option value="transporte de carga extradimensioanda">Transporte de carga extradimensioanda</option>
                </select>
                <select *ngIf="request.value.tipoDeServicio.nombre == 'alquiler de grua'" formControlName="especificamente" class="form-control" aria-placeholder="tipo de persona">
                  <option selected="true" disabled="disabled">Tipo de servicio</option>
                  <option value="gruá ph">Gruá PH</option>
                  <option value="gruá telescopica">Gruá Telescopica</option>
                  <option value="gruá de gancho">Gruá de Gancho</option>
                  <option value="gruá autodescargable">Gruá auto-descargable</option>
                  <option value="telehandler">Telehandler</option>
                  <option value="ManLift">ManLift</option>
                </select>
                <span *ngIf="submitted && errors.tipoDeServicio == 'Este campo es requerido'" class="invalid-feedback">
                  Este campo es requerido.
                </span>
              </div>
              <div class="col-sm-12"></div>

              <!-- Origen -->
              <div class="vs-input-field col-md-3">
                  <span class="vs-field-label">Origen</span>
                  <input placeholder="Ej: Bogotá" formControlName="origen">
                  <span *ngIf="submitted && request.get('origen').errors?.required" class="invalid-feedback">
                    Este campo es requerido.
                  </span>
                  <span *ngIf="submitted && request.get('origen').errors?.pattern" class="invalid-feedback">
                    Introduce un origen valido.
                  </span>
              </div>

              <!-- Destino -->
              <div *ngIf="request.value.tipoDeServicio.nombre == 'transporte de carga'" class="vs-input-field col-md-3">
                <span class="vs-field-label">Destino</span>
                <input matInput placeholder="Ej: Manizales" formControlName="destino">
                <span *ngIf="submitted && request.get('destino').errors?.pattern" class="invalid-feedback">
                  Introduce un destino valido.
                </span>
              </div>

              <div class="col-sm-12"></div>
                <!-- Tipo de Persona-->
                <div formGroupName="cliente" class="vs-input-field col-md-5">
                  <span class="vs-field-label">Tipo de persona</span>
                  <select formControlName="tipo" class="form-control" aria-placeholder="tipo de persona">
                    <option selected="true" disabled="disabled">Tipo de persona</option>
                    <option value="empresa">Empresa</option>
                    <option value="natural">Natural</option>
                  </select>
                  <span *ngIf="submitted && request.get('cliente').get('tipo').errors?.required" class="invalid-feedback">
                    Este campo es requerido.
                  </span>
                </div>

                <!-- Cedula or Nit-->
                <div *ngIf="request.value.cliente.tipo != ''" formGroupName="cliente" class="vs-input-field col-md-5">
                  <span class="vs-field-label">{{request.value.cliente.tipo == 'empresa' ? 'NIT' : 'Cedula'}}</span>
                  <input formControlName="documento" *ngIf="request.value.cliente.tipo == 'empresa'"  matInput>
                  <input formControlName="documento" *ngIf="request.value.cliente.tipo == 'natural'" matInput>
                  <span *ngIf="submitted && request.get('cliente').get('documento').errors?.required" class="invalid-feedback">
                    Este campo es requerido.
                  </span>
                  <span *ngIf="submitted && request.get('cliente').get('documento').errors?.pattern" class="invalid-feedback">
                    Introduce un {{request.value.cliente.tipo == 'empresa' ? 'NIT' : 'Cedula'}} valido.
                  </span>
                  <span *ngIf="submitted && request.get('cliente').get('documento').errors?.maxlength" class="invalid-feedback">
                    Minimo limite de caracteres 10.
                  </span>
                </div>
                <div class="col-sm-12"></div>
                  <div formGroupName="cliente" *ngIf="request.value.cliente.tipo == 'empresa'"  class="vs-input-field col-md-5">
                    <span class="vs-field-label">Nombre Empresa</span>
                    <input formControlName="nombreEmpresa" matInput>
                  </div>
                  <div class="col-sm-12"></div>

                    <div class="col-sm-12"></div>
                <!-- Mensaje-->
                <div class="vs-input-field multiline col-md-6">
                  <span class="vs-field-label"> Mensaje acerca tu solicitud</span>
                  <textarea formControlName="mensaje" class="txt-a" matInput> </textarea>
                  <span *ngIf="submitted && request.get('mensaje').errors?.required" class="invalid-feedback">
                    Este campo es requerido.
                  </span>
                  <span *ngIf="submitted && request.get('mensaje').errors?.pattern" class="invalid-feedback">
                    Introduce un mensaje valido.
                  </span>
                </div>
                <div class="vs-input-field col-sm-12 vs-text-align-right vs-margin-top-medium">
                  <button class="vs-color-grey" color="accent" mat-button matStepperPrevious>REGRESAR</button>
                  <button mat-flat-button *ngIf="!isCreatingRequest" (click)="nextStep(stepper)" color="primary">CONTINUAR</button>
                  <div *ngIf="isCreatingRequest" >
                    <button mat-flat-button *ngIf="!isLoading; else spinner" (click)="nextCreateRequest()" color="primary">CREAR SOLICITUD</button>
                    <ng-template #spinner>
                      <mat-spinner class="vs-margin-center">
                      </mat-spinner>
                    </ng-template>
                  </div>
                </div>
            </form>
          </mat-step>

          <!-- third step -->
          <mat-step *ngIf="!isCreatingRequest">
            <h1 class="vs-section-title vs-color-vs vs-text-align-center">
              BIEN, YA ESTAMOS CASI LISTOS!!!
            </h1>
            <p *ngIf="!isRegistered" class="vs-text-align-center vs-color-grey vs-margin-bottom-large">
              Registrate o <a (click)="toggleForm()" class="vs-color-vs vs-cursor-pointer"> Accede Aqui </a> para darle seguimiento a tu solicitud
            </p>
            <p *ngIf="isRegistered" class="vs-text-align-center vs-color-grey vs-margin-bottom-large">
              Accede o <a (click)="toggleForm()" class="vs-color-vs vs-cursor-pointer"> Registrate Aqui </a> para darle seguimiento a tu solicitud
            </p>
            <form [formGroup]="user" class="row" *ngIf="!isRegistered ; else login">
              <div class="vs-margin-center">
                  <div class="vs-input-field col-md-5">
                    <span class="vs-field-label">Nombre</span>
                    <input formControlName="nombre" matInput>
                    <span *ngIf="submitted && user.get('nombre').errors?.required" class="invalid-feedback">
                      Este campo es requerido.
                    </span>
                    <span *ngIf="submitted && user.get('nombre').errors?.pattern" class="invalid-feedback">
                      Introduce un nombre valido.
                    </span>
                  </div>
                  <div class="vs-input-field col-md-5">
                    <span class="vs-field-label">Apellido</span>
                    <input formControlName="apellido" matInput>
                    <span *ngIf="submitted && user.get('apellido').errors?.required" class="invalid-feedback">
                      Este campo es requerido.
                    </span>
                    <span *ngIf="submitted && user.get('apellido').errors?.pattern" class="invalid-feedback">
                      Introduce un apellido valido.
                    </span>
                  </div>
                  <div class="col-sm-12"></div>
                  <div class="vs-input-field col-md-5">
                    <span class="vs-field-label">Telefono</span>
                    <input formControlName="telefono" matInput>
                    <span *ngIf="submitted && user.get('telefono').errors?.required" class="invalid-feedback">
                      Este campo es requerido.
                    </span>
                    <span *ngIf="submitted && user.get('telefono').errors?.pattern" class="invalid-feedback">
                      Introduce un telefono valido.
                    </span>
                    <span *ngIf="submitted && user.get('telefono').errors?.maxlength" class="invalid-feedback">
                      Maximo limite de carateres 11.
                    </span>
                  </div>
                  <div class="vs-input-field col-md-5">
                    <span class="vs-field-label">Ciudad</span>
                    <input formControlName="ciudad" matInput>
                    <span *ngIf="submitted && user.get('ciudad').errors?.required" class="invalid-feedback">
                      Este campo es requerido.
                    </span>
                    <span *ngIf="submitted && user.get('ciudad').errors?.pattern" class="invalid-feedback">
                      Introduce una ciudad valida.
                    </span>
                  </div>
                  <div class="col-sm-12"></div>
                  <div class="vs-input-field col-md-5">
                    <span class="vs-field-label">Correo</span>
                    <input formControlName="correo" matInput>
                    <span *ngIf="submitted && user.get('correo').errors?.required" class="invalid-feedback">
                      Este campo es requerido.
                    </span>
                    <span *ngIf="submitted && user.get('correo').errors?.pattern" class="invalid-feedback">
                      Introduce un correo valido.
                    </span>
                  </div>
                  <div class="col-sm-12"></div>
                    <div class="vs-input-field col-md-5">
                       <span class="vs-field-label">
                         Contraseña
                        </span>
                        <input type="password" formControlName="contrasena" matInput>
                        <span *ngIf="submitted && user.get('correo').errors?.required" class="invalid-feedback">
                          Este campo es requerido.
                        </span>
                        <span *ngIf="submitted && user.get('contrasena').errors?.minlength" class="invalid-feedback">
                          Minimo limite de caracteres 6.
                        </span>
                     </div>
                     <div class="col-sm-12"></div>
                      <div class="vs-input-field col-md-5">
                        <span class="vs-field-label">
                          Confirmar contraseña
                        </span>
                        <input type="password" formControlName="contrasenaConfirmada" matInput>
                        <span *ngIf="submitted && user.get('contrasenaConfirmada').errors?.required" class="invalid-feedback">
                          Este campo es requerido.
                        </span>
                        <span *ngIf="submitted && user.get('contrasenaConfirmada').errors?.mustMatch" class="invalid-feedback">
                          Las contraseñas deben coincidir.
                        </span>
                      </div>
                      <div class="col-sm-12"></div>
                      <div class="col-sm-6">
                        <div *ngIf="serverErrorMessages" class="alert alert-danger vs-margin-top-small" role="alert">
                          {{serverErrorMessages}}
                        </div>
                      </div>
                  </div>
            </form>

            <ng-template #login class="row">
              <form [formGroup]="credentials" class="vs-input-field" >
                <div class="col-md-6">
                  <span class="vs-field-label">Correo</span>
                  <input formControlName="email" matInput>
                </div>
                <div class="col-md-12"></div>
                <div class="col-md-6">
                  <span class="vs-field-label">Contraseña</span>
                  <input type="password" formControlName="password" matInput>
                </div>
                <div class="col-md-12"></div>
                <div class="col-md-6">
                  <div *ngIf="serverErrorMessages" class="alert alert-danger vs-margin-top-small" role="alert">
                    {{serverErrorMessages}}
                  </div>
                </div>
              </form>
            </ng-template>

            <div class="vs-input-field col-sm-12 vs-text-align-right vs-margin-top-medium">
              <button class="vs-color-grey" color="accent" mat-button matStepperPrevious>REGRESAR</button>
              <button *ngIf="!isLoading; else spinner" mat-flat-button color="primary" (click)="register()" matStepperNext>
                CONTINUAR
              </button>
              <ng-template #spinner>
                <mat-spinner class="vs-margin-center">
                </mat-spinner>
              </ng-template>
            </div>

         </mat-step>
       </mat-horizontal-stepper>
      </div>
    </div>
  </div>
</div>
